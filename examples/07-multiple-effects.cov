// Multiple Effects - combining capabilities

snippet id="http.post" kind="extern"

effects
  effect network
end

signature
  fn name="post"
    param name="url" type="String"
    param name="body" type="String"
    returns union
      type="Response"
      type="HttpError"
    end
  end
end

end


snippet id="upload.upload_file" kind="fn"

effects
  effect console
  effect filesystem
  effect network
end

signature
  fn name="upload_file"
    param name="path" type="String"
    param name="url" type="String"
    returns union
      type="Unit"
      type="IoError"
      type="HttpError"
    end
  end
end

body
  step id="s1" kind="call"
    fn="console.println"
    arg name="message" lit="Reading file..."
    as="_"
  end
  step id="s2" kind="call"
    fn="fs.read_file"
    arg name="path" from="path"
    as="content"
  end
  step id="s3" kind="call"
    fn="console.println"
    arg name="message" lit="Uploading..."
    as="_"
  end
  step id="s4" kind="call"
    fn="http.post"
    arg name="url" from="url"
    arg name="body" from="content"
    as="response"
  end
  step id="s5" kind="bind"
    field="body" of="response"
    as="response_body"
  end
  step id="s6" kind="call"
    fn="concat"
    arg name="a" lit="Done: "
    arg name="b" from="response_body"
    as="message"
  end
  step id="s7" kind="call"
    fn="console.println"
    arg name="message" from="message"
    as="_"
  end
end

end

// The function's effect set is the union of all declared effects.
// Effects propagate transitively through the call graph.
